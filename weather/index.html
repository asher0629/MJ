<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>weather</title>
    <link rel="icon" href="images/favicon.ico">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/weather-icons.min.css">
</head>
<body>
    <div id="weather_info">
        <h3 class="date"></h3>
        <h3 class="week"></h3>
        <h1 class="city"></h1>
        <section>
            <i class="icon wi"></i>
            <p class="w_id"></p>
            <p class="temp"></p>
            <aside>
                <p class="feels_like"></p>
                <p class="temp_max"></p>
                <p class="temp_min"></p>
            </aside>
        </section>
        <img class="load_img" src="loading.gif" width="50">
    </div>
    <div id="weekly_info">
            <p class="ctemp"></p>
    </div>

    <script>
        var url = 'https://api.openweathermap.org/data/2.5/weather?q=seoul&appid=28981aff47d330d87837128734f55567';
         $('weather_info .load_img').show();
            $.getJSON(url, function(data) {
                var  Now = new Date(),
                    StrNow = String(Now),
                    nowYear = String(Now.getFullYear()),
                    nowMon = String(Now.getMonth()+1),
                    nowDay = String(Now.getDate());
                    if(nowMon.length == 1) {
                    nowMon = "0"+nowMon
                    }
                var NowToday = nowYear+nowMon+nowDay;
                var week = new Array('일','월','화','수','목','금','토');
                
                    

                var sys = data.sys;                 // 국가명, 일출/일몰
                var wind = data.wind;         
                var city = data.name;               // 도시명
                var weather = data.weather;         // 날씨 객체
                var main = data.main;               // 온도 기압 관련 객체
                var wmain = weather[0].main;        // 구름 상태(Cloudiness)
                var w_id = weather[0].id;           // 날씨상태 id 코드
                var icon = weather.icon;            // 날씨 아이콘 정보
                var country = sys.country;          // 국가명
                var temp = main.temp;               // 현재 온도
                var temp_min = main.temp_min;       // 최저 온도
                var temp_max = main.temp_max;       // 최고 온도
                var feel = main.feels_like;         // 체감 온도


                var nowTimestamp = Math.floor(Date.now() / 1000);
                var weatherClass = 'wi wi-owm-';
                weatherClass += (nowTimestamp >= data.sunrise && nowTimestamp <= data.sunset ? 'day' : 'night');
                weatherClass += ('-' + weather[0].id);

                $("#weather_info .icon").addClass(weatherClass);
                $('#weather_info .date').html(NowToday);
                $('#weather_info .week').html(week[Now.getDay()]);
                // $('#weather_info .d_weather').html(d_weather);

                $('#weather_info>.city').html(city);
                $('#weather_info .w_id').html(wmain);
                $('#weather_info .temp_min').html(parseInt(temp_min-273.15)+'&deg;' + 'min');
                $('#weather_info .temp_max').html(parseInt(temp_max-273.15)+'&deg;' + 'max');
                $('#weather_info .temp').html('현재 온도 : ' + parseInt(temp-273.15)+'&deg;');
                $('#weather_info .feels_like').html('체감 온도 : ' + parseInt(feel-273.15)+'&deg;');
                $('#weather_info .load_img').hide();

            })
            .fail(function(){
                alert("loading error");
            });

    </script>

    <script>
        url = 'https://api.openweathermap.org/data/2.5/onecall?lat=37.57&lon=126.98&exclude=current,daily&appid=28981aff47d330d87837128734f55567';
        $.getJSON(url, function(data) {
                var  Now = new Date(),
                    StrNow = String(Now),
                    nowYear = String(Now.getFullYear()),
                    nowMon = String(Now.getMonth()+1),
                    nowDay = String(Now.getDate());
                    if(nowMon.length == 1) {
                    nowMon = "0"+nowMon
                    }
                var NowToday = nowYear+nowMon+nowDay;
                var week = new Array('일','월','화','수','목','금','토');
                var nowTimestamp = Math.floor(Date.now() / 1000);
                var weatherClass = 'wi wi-owm-';
                weatherClass += (nowTimestamp >= data.sunrise && nowTimestamp <= data.sunset ? 'day' : 'night');
                weatherClass += ('-' + weather[0].id);
                
                var current = current.dt;
                var ctemp = current.temp;
                var dtemp = daily.temp;

            });
    </script>
</body>
</html>