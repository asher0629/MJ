<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>weather</title>
    <link rel="icon" href="images/favicon.ico">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/weather-icons.min.css">
</head>
<body>
    <div id="weather_info">
        <div class="day">
        <h3 class="date"></h3>
        </div>
        <h1 class="city"></h1>
        <section>
            <i class="icon wi"></i>
            <p class="temp"></p>
            <p class="pop"></p>
            <div class="max_min">
                <!-- <p class="feels_like"></p> -->
                <p class="temp_min"></p>
                <p class="temp_max"></p>
                
                
            </div>
        </section>

        <div id="weekly">
            <p class="today"></p>
            <p class="f-day"></p>
            <p class="s-day"></p>
            <p class="t-day"></p>
            <p class="four-day"></p>
            <p class="five-day"></p>
            <p class="six-day"></p>
        </div>
        <div id="weekweather">
            <p class="todayw"></p>
            <p class="f-dayw"></p>
            <p class="s-dayw"></p>
            <p class="t-dayw"></p>
            <p class="four-dayw"></p>
            <p class="five-dayw"></p>
            <p class="six-dayw"></p>
        </div>
        <!-- <img class="load_img" src="loading.gif" width="50"> -->
    </div>

    <script>
        url = 'https://api.openweathermap.org/data/2.5/onecall?id=1842936&lat=37.623611&lon=126.714172&exclude=minutely&appid=28981aff47d330d87837128734f55567';
         $('weather_info .load_img').show();
            $.getJSON(url, function(data) {
                var  Now = new Date(),
                    StrNow = String(Now),
                    nowYear = String(Now.getFullYear()),
                    nowMon = String(Now.getMonth()+1),
                    nowDay = String(Now.getDate());
                var week = new Array('SUN','MON','TUE','WED','THU','FRI','SAT','SUN','MON','TUE','WED','THU','FRI','SAT');              
                var month = new Array('JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC');
                var NowToday = month[Now.getMonth()]+nowDay+'th'+week[Now.getDay()];
                
                    

                var timezone = data.timezone;       
                var city = timezone.replace('Asia/Seoul','Gimpo');
                var current = data.current;        
                var ctemp = data.current.temp;
                var feel = current.feels_like;
                var c_weather = current.weather[0].main;
                var c_icon = current.weather[0].id;
                var c_dscript = current.weather[0].description;
                var daily = data.daily;
                var dtemp = daily[Now.getDay()].temp;
                var temp_min = daily[Now.getDay()].temp.min;
                var temp_max = daily[Now.getDay()].temp.max;
                var rain = daily[Now.getDay()].rain;
                var dew_point = daily[Now.getDay()].dew_point;
                var pop = daily[Now.getDay()].pop;
                var fmin = daily[1].temp.min;
                var fmax = daily[1].temp.max;
                var smin = daily[2].temp.min;
                var smax = daily[2].temp.max;
                var tmin = daily[3].temp.min;
                var tmax = daily[3].temp.max;
                var fourmin = daily[4].temp.min;
                var fourmax = daily[4].temp.max;
                var fivemin = daily[5].temp.min;
                var fivemax = daily[5].temp.max;
                var sixmin = daily[6].temp.min;
                var sixmax = daily[6].temp.max;


                var nowTimestamp = Math.floor(Date.now() / 1000);
                var weatherClass = 'wi wi-owm-';
                // weatherClass += (nowTimestamp >= data.sunrise && nowTimestamp <= data.sunset ? 'night' : 'day');
                weatherClass += (current.weather[0].id);

                $("#weather_info .icon").addClass(weatherClass);
                $('#weather_info .date').html(NowToday);
                $('#weather_info>.city').html(city);
                $('#weather_info .w_id').html(c_dscript);
                $('#weather_info .temp_min').html(parseInt(temp_min-273.15)+'&deg;' + 'min');
                $('#weather_info .temp_max').html(parseInt(temp_max-273.15)+'&deg;' + 'max');
                $('#weather_info .temp').html(parseInt(ctemp-273.15)+'&deg;');
                $('#weather_info .feels_like').html('체감 온도 : ' + parseInt(feel-273.15)+'&deg;');
                $('#weather_info .pop').html('강수확률 : ' + parseInt(pop*100) + '%');
                $('#weather_info .load_img').hide();


                // 요일별
                    $('#weekly .today').html(week[Now.getDay()]);
                    $('#weekly .f-day').html(week[Now.getDay()+1]);
                    $('#weekly .s-day').html(week[Now.getDay()+2]);
                    $('#weekly .t-day').html(week[Now.getDay()+3]);
                    $('#weekly .four-day').html(week[Now.getDay()+4]);
                    $('#weekly .five-day').html(week[Now.getDay()+5]);
                    $('#weekly .six-day').html(week[Now.getDay()+6]);

                    $('#weekweather .todayw').html(parseInt(temp_min-273.15)+'&deg;'+'min'+'<br>'+parseInt(temp_max-273.15)+'&deg;' + 'max');
                    $('#weekweather .f-dayw').html(parseInt(fmin-273.15)+'&deg;'+'min'+'<br>'+parseInt(fmax-273.15)+'&deg;' + 'max');
                    $('#weekweather .s-dayw').html(parseInt(smin-273.15)+'&deg;'+'min'+'<br>'+parseInt(smax-273.15)+'&deg;' + 'max');
                    $('#weekweather .t-dayw').html(parseInt(tmin-273.15)+'&deg;'+'min'+'<br>'+parseInt(tmax-273.15)+'&deg;' + 'max');
                    $('#weekweather .four-dayw').html(parseInt(fourmin-273.15)+'&deg;'+'min'+'<br>'+parseInt(fourmax-273.15)+'&deg;' + 'max');
                    $('#weekweather .five-dayw').html(parseInt(fivemin-273.15)+'&deg;'+'min'+'<br>'+parseInt(fivemax-273.15)+'&deg;' + 'max');
            })
            .fail(function(){
                alert("loading error");
            });

    </script>
</body>
</html>